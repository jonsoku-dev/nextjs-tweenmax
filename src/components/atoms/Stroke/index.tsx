/*
 * Copyright (c) 2021 LINE Corporation. All rights reserved.
 * LINE Corporation PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
 */

import React, { useEffect, useRef, useState } from 'react'
import styled from 'styled-components'

export interface StrokeProps {}

const Stroke: React.FC<StrokeProps> = () => {
  const [pathLength, setPathLength] = useState(0)
  const [strokeDashoffset, setStrokeDashoffset] = useState(0)
  const pathRef = useRef<SVGPathElement | null>(null)

  useEffect(() => {
    const length = pathRef.current?.getTotalLength()
    if (length) {
      setPathLength(length)
      setStrokeDashoffset(length)
    }
  }, [])

  useEffect(() => {
    const handler = () => {
      // What % down is it?
      const scrollPercentage =
        (document.documentElement.scrollTop + document.body.scrollTop) /
        (document.documentElement.scrollHeight -
          document.documentElement.clientHeight)
      // Length to offset the dashes
      const drawLength = pathLength * scrollPercentage
      // Draw in reverse
      setStrokeDashoffset(pathLength - drawLength)
    }
    window.addEventListener('scroll', handler, { passive: true })
    return () => window.removeEventListener('scroll', handler)
  }, [pathLength])

  return (
    <Container pathLength={pathLength} strokeDashoffset={strokeDashoffset}>
      <svg viewBox="0 0 340 1000">
        <path
          ref={pathRef}
          className="path"
          d="m92.5,33c-1,2 -2.62022,4.6689 -4,8c-1.95131,4.71088 -2,9 -2,13c0,8 1.83327,13.92098 6,18c5.76119,5.63992 11.95332,5.49903 20,6c9.98067,0.62138 17.26662,-0.10844 32,-5c5.11086,-1.69682 10.93796,-4.49829 17,-5c4.98296,-0.4124 9.05664,0.91753 12,3c4.0817,2.88786 8.72961,6.22885 13,11c1.88634,2.10754 4.48874,7.02997 4,11c-0.50377,4.09222 -1.73874,9.01381 -10,18c-5.28589,5.74973 -14.87593,10.58601 -23,12c-9.90103,1.72327 -18,1 -22,1c-2,0 -3.36655,-1.02248 -3,-4c0.50377,-4.09222 1.54915,-6.95517 5,-8c1.91418,-0.57957 8.3054,0.36167 13,3c4.35883,2.44962 5.69255,5.186 7,7c1.65381,2.29454 2.24437,5.01498 2,7c-0.50377,4.09221 -3.05704,6.88979 -7,9c-7.10829,3.80424 -13.06134,5.82462 -19,8c-5.05659,1.85226 -12,7 -15,11c-3,4 -5.4758,8.93587 -5,15c0.49471,6.30518 5.57111,11.67947 10,14c11.20432,5.87053 22.96881,6.49957 35,7c6.99396,0.29091 13.186,-0.69255 15,-2c4.58908,-3.30762 5.40215,-6.54358 10,-11c3.59033,-3.47987 7.01022,-5.24744 10,-5c6.06204,0.50171 11.08612,0.72005 18,3c8.1142,2.67578 11.69238,4.41092 15,9c2.6149,3.62799 5,10 5,16c0,4 0.09943,7.74454 -7,11c-5.52916,2.53542 -13.06363,1.26741 -22,-1c-7.0565,-1.79044 -10,-4 -10,-4c0,1 0,2 0,4c0,3 -0.36703,5.19801 3,11c1.80972,3.11848 5.73129,8.66655 10,10c6.74944,2.10837 15.21512,0.63921 22,-2c6.25188,-2.43188 13.61383,-6.297 16,-9c1.47984,-1.67633 2,-3 2,-3c0,0 0.69344,-1.4588 2,-2c5.54327,-2.2961 14.47955,-0.23787 21,3c4.47827,2.22377 7.67261,5.70848 10,12c1.43048,3.867 2.56732,11.05414 2,14c-1.01837,5.28799 -4.80902,8.32144 -8,10c-4.76599,2.50705 -10.06766,2.97092 -17,2c-7.20975,-1.00977 -10.15224,-2.76538 -12,-2c-1.30656,0.5412 -2.49345,1.87857 -3,5c-0.64073,3.94836 -0.63832,10.30539 2,15c4.89925,8.71765 11.90494,12.31177 18,14c8.88501,2.461 27.09811,1.26074 46,-6c10.05408,-3.86206 15.87857,-6.49347 19,-7c0.98709,-0.16019 2,0 3,1c3,3 10.61716,8.12686 18,14c9.9606,7.9238 17.98163,18.71201 19,24c0.75644,3.92783 -0.5582,5.51929 -4,8c-1.814,1.30746 -4.05414,1.43268 -7,2c-5.28799,1.01837 -11.21167,2.71411 -14,5c-2.18735,1.79318 -2,3 3,3c15,0 33.30264,0.73212 61,-5c22.33032,-4.62137 47.11151,-13.27655 62,-27c12.05963,-11.11597 14.72952,-19.97662 14,-30c-0.5986,-8.22446 -5.45923,-19.4577 -14,-29c-4.71585,-5.26884 -13,-11 -21,-17c-4,-3 -7,-5 -8,-7c-1,-2 -0.19434,-5.44841 4,-7c3.867,-1.4305 10.2562,-0.92332 19,2c11.45956,3.83128 19.58835,9.38879 30,20c7.44495,7.58766 12.61545,19.2686 19,28c3.77948,5.16873 7.49829,12.93796 8,19c0.65985,7.97275 0.53711,10.15378 -2,18c-1.65686,5.12396 -5.63297,12.198 -9,18c-3.61945,6.23697 -5.724,11.22272 -9,15c-1.85318,2.13675 -5.69247,5.39401 -12,10c-21.05951,15.37848 -45.8049,28.41324 -73,41c-8.93796,4.13678 -37.98563,13.69437 -56,13c-15.12152,-0.58286 -28.15512,-4.56952 -37,-8c-9.1824,-3.56137 -14.93079,-7.09341 -23,-13c-6.94141,-5.08105 -16.04294,-10.92578 -23,-15c-5.03162,-2.94666 -8,-3 -10,-3c-3,0 -3.88049,1.25195 -10,4c-4.91257,2.20605 -11.21512,3.36078 -18,6c-4.16792,1.62125 -8.186,3.69254 -10,5c-2.29454,1.65381 -2,4 -2,7c0,3 2.41156,7.40402 6,12c4.35162,5.57346 8.76108,7.41589 12,9c2.84073,1.38934 3.69344,2.4588 5,3c0.92387,0.38269 2.49756,1.92578 3,7c0.49269,4.97568 1.03328,9.93924 -3,16c-3.54742,5.33066 -10.9281,7.49359 -23,9c-11.94893,1.49106 -22.13948,3.21039 -36,1c-8.14331,-1.29865 -14.60948,-3.1629 -19,-7c-4.82133,-4.21362 -6,-9 -6,-13c0,-4 1.09789,-6.82443 3,-8c0.85065,-0.52573 2.14183,-0.23859 9,4c6.13412,3.79111 13.56287,9.63034 18,17c3.46013,5.74695 5,10 5,14c0,2 -1.54123,4.51871 -6,8c-4.59599,3.58844 -15.03804,8.88928 -21,11c-8.05415,2.85141 -11.95517,3.54916 -13,7c-0.57957,1.91418 -0.21014,5.07843 1,8c1.71141,4.13171 5.28702,9.65131 9,13c4.33005,3.90521 7.9258,4.49756 13,5c4.97566,0.49268 10.78423,-2.65457 19,-5c4.90314,-1.39975 6.42336,-0.42825 12,-5c1.09367,-0.89661 3.28859,-4.86829 5,-9c1.21014,-2.92157 1.23463,-5.15225 2,-7c0.5412,-1.30655 1.54915,-3.95517 5,-5c4.78546,-1.44891 13.17819,-1.8764 30,2c14.18839,3.26956 28.67578,8.26822 37,18c5.24057,6.12671 5,11 5,19c0,4 -1.43967,8.43628 -7,15c-2.74234,3.23724 -7.93796,6.49829 -14,7c-5.97955,0.49487 -11.08743,-0.79395 -16,-3c-4.07967,-1.83203 -6.43275,-8.28326 -5,-10c3.20374,-3.83875 14.11661,-6.59735 25,-5c10.32965,1.51608 21.22769,7.69568 28,13c7.25821,5.68494 9.49347,8.87854 10,12c0.48056,2.96124 0.38934,5.1593 -1,8c-1.58411,3.23889 -4.29413,5.74292 -13,16c-8.28696,9.76355 -14.52209,17.28894 -20,31c-4.23016,10.58801 -4.91434,20.46716 -1,27c6.58212,10.98523 16.82092,14.85693 34,18c37.70172,6.89795 51.05353,6.08392 62,5c10.14841,-1.00488 23.91946,-6.06805 29,-12c3.79303,-4.42865 5.09662,-13.01691 4,-19c-0.91925,-5.0155 -2.74707,-7.617 -7,-9c-5.78461,-1.88104 -14.34613,-2.79333 -24,0c-4.29593,1.24304 -8.73871,7.25745 -7,13c2.08966,6.90167 12.39194,14.41766 26,24c13.4101,9.44293 25.16483,15.67938 31,22c3.95529,4.28436 4,8 4,10c0,4 -1.19028,6.88153 -3,10c-2.24469,3.86798 -9.02997,7.48871 -13,7c-8.18442,-1.00757 -15,-4 -18,-5c0,0 -0.12396,-1.34314 5,-3c11.76932,-3.80566 27.0177,-8.26532 44,-7c19.36282,1.44269 32,8 42,12c10,4 14.76303,7.38055 21,11c9.66998,5.61169 17.86963,8.62262 26,10c10.8902,1.84491 19.52863,0.68506 23,-4c4.90924,-6.62567 4.62415,-18.90167 -1,-31c-2.10773,-4.53406 -7.92981,-6.88953 -15,-7c-9.05426,-0.14142 -16.81934,3.04022 -24,10c-4.59784,4.45642 -8.89487,18.96704 -9,34c-0.13303,19.02582 4.96484,34.01074 12,57c3.9801,13.0061 7.32898,23.95551 7,34c-0.1991,6.07953 -4.69897,14.32037 -10,19c-8.54764,7.54572 -17.87003,12.47345 -28,15c-19.78983,4.93585 -32.94574,6.4964 -49,8c-15.96136,1.49493 -33.59003,-0.30243 -53,-8c-12.4715,-4.94592 -25.54065,-14.74536 -31,-29c-3.99869,-10.4408 -2.66251,-17.31 -1,-20c0.7435,-1.203 1.16019,-3.01294 1,-4c-0.50653,-3.12146 -3.90436,-6.258 -9,-8c-6.8887,-2.35498 -18.0123,-4.85126 -31,-6c-10.0108,-0.88544 -22.67352,-1.78455 -30,2c-8.19125,4.2312 -11.15814,9.26208 -14,15c-3.65985,7.38953 -2.54706,14.11237 -4,19c-1.53448,5.16193 -2.56342,8.34235 -5,11c-4.32715,4.71973 -8.70743,6.80493 -16,9c-10.70587,3.22247 -22.99464,1.95056 -32,1c-9.99435,-1.05493 -26.21002,-6.56158 -37,-12c-9.19383,-4.63391 -22.65961,-9.28436 -30,-23c-2.40601,-4.49567 -1.40601,-7.513 1,-9c2.68999,-1.66254 8.19766,-1.43671 13,1c8.41295,4.26874 15.00041,8.29156 19,15c5.51543,9.25092 6.83803,14.21399 5,22c-0.51375,2.17627 -5,7 -9,10c-4,3 -10.97603,6.04224 -18,10c-8.96971,5.05414 -24.61382,13.17584 -45,29c-19.62192,15.2309 -32.72527,28.07617 -38,40c-4.61262,10.42706 -2.53234,20.77612 3,24c4.65282,2.7113 18.11935,2.52441 28,0c16.24135,-4.14954 26.67035,-11.48395 37,-13c3.9576,-0.58087 5,0 5,0c2,1 4.22885,2.72961 9,7c6.32262,5.659 10.50897,13.59595 6,27c-3.28258,9.7583 -11.16586,19.91034 -22,29c-9.3513,7.84558 -16.84235,11.45978 -25,14c-3.93666,1.22583 -8.20681,1.18732 -10,-1c-2.28588,-2.78833 -4.44164,-7.11621 -3,-16c0.50654,-3.12146 6.29608,-8.6142 16,-6c11.6671,3.14307 22.92892,8.92896 30,16c3.53554,3.53552 4.48874,7.02997 4,11c-0.50377,4.09222 -2.49623,6.90778 -3,11c-0.36655,2.97754 -1.24437,6.01501 -1,8c0.50377,4.09222 2.74184,8.32715 9,13c5.77809,4.31433 23.65419,12.24658 36,15c16.7068,3.72595 28.74135,3.16492 34,-1c6.12256,-4.84912 8.47545,-13.86194 10,-20c1.46626,-5.90338 2.74252,-8.35291 4,-9c5.4086,-2.78339 20.13794,-0.64862 31,2c13.21429,3.22223 28.23541,8.73578 35,15c4.15057,3.84351 6,10 6,15c0,6 -0.41156,11.40405 -4,16c-4.35162,5.57349 -11.53146,11.73132 -19,16c-8.55075,4.88721 -18.02649,10.10059 -22,9c-1.36288,-0.37744 -1.41229,-6.1145 1,-14c3.42401,-11.19263 10.04495,-14.73315 16,-14c8.18442,1.00757 16.06067,5.9281 22,11c8.08374,6.90308 11.98163,11.71204 13,17c1.13464,5.89172 0.08099,10.10706 1,14c0.51373,2.17627 0.297,3.61389 3,6c3.35266,2.95972 10.90356,6.27087 19,9c9.89337,3.33484 16.9856,6.08093 28,8c5.99249,1.04407 13,1 22,1c12,0 23.03705,0.55115 42,-1c18.05048,-1.47656 30,-3 42,-5c12,-2 28.72549,-3.30811 35,-7c4.87549,-2.86877 6.70197,-9.16235 5,-18c-2.03674,-10.57605 -7.91827,-15.11218 -12,-18c-2.94336,-2.08252 -7.03815,-3.27832 -11,1c-4.55789,4.922 -5.49939,11.96265 -6,22c-0.34869,6.99133 1.28677,14.30505 5,22c2.53415,5.25146 5.44839,8.80566 7,13c1.43048,3.86694 1.70709,6.29285 1,7c-0.70709,0.70715 -6,1 -11,1c-5,0 -10,0 -13,0c-4,0 -5,0 -6,0c0,0 -2,1 -3,1l0,-1l0,0l-1,0"
          id="svg_2"
          stroke="#000"
          fill="none"
        />
      </svg>
      <AbsoluteBox>
        <p>total pathLength : {pathLength}</p>
        <p>strokeDashoffset : {strokeDashoffset}</p>
      </AbsoluteBox>
    </Container>
  )
}

export default Stroke

const Container = styled.div<{ pathLength: number; strokeDashoffset: number }>`
  .path {
    stroke-dasharray: ${(props) => `${props.pathLength} ${props.pathLength}`};
    stroke-dashoffset: ${(props) => props.strokeDashoffset};
  }

  // @keyframes dash {
  //   from {
  //     stroke-dashoffset: ${(props) => props.pathLength};
  //   }
  //   to {
  //     stroke-dashoffset: 0;
  //   }
  // }
`

const AbsoluteBox = styled.div`
  position: fixed;
  right: 60px;
  bottom: 60px;
  border: 1px solid black;
  width: 300px;
  height: 100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
`
